<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <link rel="icon" type="image/x-icon"
        href="https://res.cloudinary.com/ccssiteimage/image/upload/v1613109629/site/favicon_gfqibc.ico">
    <title>Set Password - CCS</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- GA4 script -->
          <script async src="https://www.googletagmanager.com/gtag/js?id=G-624NHLKTKL"></script>
          <script>
              window.dataLayer = window.dataLayer || [];
              function gtag(){dataLayer.push(arguments);}
              gtag('js', new Date());
      
              gtag('config', 'G-624NHLKTKL');
          </script>
    <!--  GA4 script -->
    <!-- Google Tag Manager -->
    <script>
        (function (w, d, s, l, i) {
            w[l] = w[l] || [];
            w[l].push({ 'gtm.start': new Date().getTime(), event: 'gtm.js' });
            var f = d.getElementsByTagName(s)[0],
                j = d.createElement(s),
                dl = l != 'dataLayer' ? '&l=' + l : '';
            j.async = true;
            j.src = 'https://www.googletagmanager.com/gtm.js?id=' + i + dl;
            f.parentNode.insertBefore(j, f);
        })(window, document, 'script', 'dataLayer', 'GTM-TZCX5VP');
    </script>
    <!-- End Google Tag Manager -->
    <!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css" integrity="sha384-B0vP5xmATw1+K9KRQjQERJvTumQW0nPEzvF6L/Z6nronJ3oUOFUFpCjEUQouq2+l" crossorigin="anonymous"> -->
    <link rel="stylesheet"
        href="https://crown-commercial-service.github.io/conclave-ssso-ui/toolkit.styles.min.css">
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Source+Sans+Pro&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,500" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
</head>
<style>
    html,
    body {
        height: 100%;
    }

    body {
        margin: 0;
        font-family: "Source Sans Pro";
        font-style: normal;
        font-weight: 300;
        background-color: #ffffff;
        color: #000000;
    }

    .invalid {
        border-left: red;
        border-left-style: solid;
        padding-left: 4px;
    }

    .login-container {
        margin: 10px 30px;
        display: block;
    }

    ul,
    ol {
        padding-left: 12px;
    }

    hr {
        width: 160px;
        height: 0px;
        left: 30px;
        border: 2px solid #B1B4B6;
    }

    app-topnav a {
        text-decoration: none;
    }

    .right-content {
        text-align: end;
    }

    .footer-global:after {
        height: 20rem;
    }

    .govuk-footer__meta-item {
        margin-bottom: -15px;
    }

    /* Gov UK Styles */
    .footer-global {
        background-color: #2F2F2F;
        color: #fff;
        padding-top: 3.125rem;
    }

    .govuk-footer__link.govuk-footer__link {
        color: white;
        text-decoration: underline;
    }

    .footer-global .logo {
        margin-bottom: 2.5rem;
    }

    .govuk-footer__link:visited {
        color: #454a4c;
    }

    .footer-global .govuk-link:link,
    a:link {
        color: #005ea5;
    }

    .footer-global .logo {
        display: block;
    }

    .footer-global .govuk-link,
    a {
        font-family: "Source Sans Pro";
    }

    .footer-global .govuk-width-container {
        max-width: none;
        margin-right: 40px;
        margin-left: 40px;
    }

    .navigation-text {
        margin-bottom: 100px;
        text-decoration: underline;
        font-size: 19px;
    }

    .govuk-width-container {
        max-width: unset;
    }

    .govuk-input--error {
        border: 4px solid #b10e1e !important;
    }

    .govuk-input {
        font-family: "Source Sans Pro";
        font-weight: 400;
        font-size: 16px;
        font-size: 1rem;
        line-height: 1.25;
        box-sizing: border-box;
        width: 375px;
        height: 40px;
        margin-top: 0;
        padding: 5px;
        border: 2px solid #0b0c0c;
        border-radius: 0;
        -webkit-appearance: none;
        -moz-appearance: none;
        appearance: none;
    }

    .govuk-select {
        font-family: "Source Sans Pro";
        font-weight: 400;
        font-size: 16px;
        font-size: 1rem;
        line-height: 1.25;
        -webkit-box-sizing: border-box;
        box-sizing: border-box;
        max-width: 100%;
        height: 40px;
        height: 2.5rem;
        padding: 5px;
        border: 2px solid #0b0c0c;
        min-width: 15.8em;
    }

	.govuk-button {
      background-color: #007E8A;
      border-radius: .1875rem;
      box-shadow: 0 3px 0 #003618;
      padding-left: 1.875rem;
      padding-right: 1.875rem;
      width: auto;
      margin-bottom: 22px;
      padding: 8px 10px 10px;
      height: 2em;
    }

    .govuk-button:focus {
      background-color: #ffdd00;
	  color:#000000 !important;
	  font-style:normal;
	  outline: 3px solid transparent;
	  border-color: #ffdd00;
      box-shadow: inset 0 0 0 1px #ffdd00;
    }


    .govuk-button--secondary:focus {
      background-color: #ffdd00 !important;
	  color:#FFFFFF !important;
    }

    .govuk-button:hover {
      background-color: #015e66;
	  color:#FFFFFF !important;
    }

    .govuk-button--warning,
    .govuk-button--warning:link,
    .govuk-button--warning:visited,
    .govuk-button--warning:active,
    .govuk-button--warning:hover {
        color: #fff;
    }

    .govuk-button--warning {
        background-color: #d4351c !important;
        -webkit-box-shadow: 0 2px 0 #55150b !important;
        box-shadow: 0 2px 0 #55150b !important;
    }

    .govuk-button--secondary,
    .govuk-button--secondary:link,
    .govuk-button--secondary:visited,
    .govuk-button--secondary:active,
    .govuk-button--secondary:hover {
        color: #0b0c0c;
    }

    .govuk-button--secondary {
        background-color: #f3f2f1 !important;
        -webkit-box-shadow: 0 2px 0 #929191 !important;
        box-shadow: 0 2px 0 #929191 !important;
    }

    .govuk-\!-font-weight-bold {
        font-weight: 600 !important;
    }

    .govuk-error-summary__list a,
    .govuk-error-summary__list a:visited {
        color: #b10e1e;
    }

    .govuk-table caption {
        padding-top: 0.75em;
        padding-bottom: 0.3em;
        color: #0b0c0c;
        caption-side: top;
    }

    .govuk-breadcrumbs__link {
        color: #0b0c0c !important;
    }

    @media (min-width: 40.0625em) {
        .govuk-width-container {
            margin-right: 48px;
            margin-left: 48px;
        }

        .govuk-error-summary {
            margin-bottom: unset;
            border: 5px solid #d4351c
        }

        .govuk-select {
            font-size: 19px;
            font-size: 1.1875rem;
            line-height: 1.25;
        }

        .govuk-button {
            margin-bottom: 32px;
        }

        .govuk-\!-font-size-18 {
            font-size: 18px !important;
            font-size: 1.125rem !important;
            line-height: 1.27778 !important;
        }
    }

    @media (min-width: 1340px) {
        .ccs-width-container {
            margin-left: 45px;
            max-width: 1280px;
        }
    }

    .header-link {
       color: #FFFFFF !important;
    }  
</style>

<body class="govuk-template__body show-flourishes pillar--none js-enabled">
            <!-- Google Tag Manager (noscript) -->
            <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-TZCX5VP" height="0" width="0"
                style="display:none;visibility:hidden"></iframe></noscript>
            <!-- End Google Tag Manager (noscript) -->
    <header class="header-global">
        <div class="ccs-width-container">
            <div class="nav-wrapper">
                <a href="/" class="logo"><img
                        src="https://res.cloudinary.com/ccssiteimage/image/upload/v1613028512/site/CCS_WHITE_SML_AW_space-01_p3dj6u.png"
                        alt="Go to the CCS homepage"></a>
                <nav class="global-navigation" data-toggle="nav"
                    data-app-uri="http://www.crowncommercial.gov.uk/contact/sendToSalesforce"
                    data-app-pathinfo="/contact/sendToSalesforce" aria-hidden="false">
                    <ul class="nav-list nav-list--primary">
                    </ul>
                </nav>
            </div>
        </div>
    </header>
    <div class="govuk-width-container">
        <div class="govuk-phase-banner">
            <p class="govuk-phase-banner__content">
                <strong class="govuk-tag govuk-phase-banner__content__tag ">
                    beta
                </strong>
                <span class="govuk-phase-banner__text">This is a new service â€“ your <a class="govuk-link"
                        target="_blank"  href="https://crowncommercial.qualtrics.com/jfe/form/SV_3xDq7uNywwujVRA">feedback</a> will help us to improve it.</span>
            </p>
        </div>
    </div>
    <div class="login-container" style="display: none;margin-top: 10px;" id="success-view">
        <h4 class="govuk-body-l" id="longin-success-message">.

        </h4>
        <a href="#" id="loginLink" class="navigation-text"> Sign in to your account </a>
    </div>

    <div id='reset-view' class="govuk-main-wrapper login-container">
        <h1 class="govuk-heading-xl" style="margin-bottom:20px">Create your password</h1>
        <div class="govuk-error-summary" aria-labelledby="error-summary-title" role="alert" tabindex="-1"
            id="error-summary" data-module="govuk-error-summary" style="display: none">
            <h2 class="govuk-error-summary__title" id="error-summary-title">
                There is a problem
            </h2>
            <div class="govuk-error-summary__body">
                <ul class="govuk-list govuk-error-summary__list">
                    <li style="display: none" id="li-error-summary-password">
                        <a href="#" onClick="scrollToError('password-form-group','newPassword');return false;"> Password
                            is
                            required
                        </a>
                    </li>
                    <li style="display: none" id="li-error-summary-confirmPassword">
                        <a href="#"
                            onclick="scrollToError('confirmPassword-form-group','confirmNewPassword');return false;">Confirm
                            Password is
                            required</a>
                    </li>
                    <li style="display: none" id="li-error-summary-general">
                        <a href="#" id="link-general-error"
                            onclick="scrollToError('password-form-group','newPassword');return false;">.
                        </a>
                    </li>

                </ul>
            </div>
        </div>

        <label class="govuk-label" style="margin-bottom:40px;"> Reset password for {{email}} </label>
        <p class="govuk-body">Your password must have:</p>

        <ul class="govuk-list govuk-list--bullet">
            <li class="guide-line-text">at least 10 characters</li>
            <li class="guide-line-text">at least one symbol (eg ?!Â£%)</li>
            <li class="guide-line-text"> at least one uppercase character</li>
            <li class="guide-line-text"> at least one lowercase character</li>
        </ul>
        <p class="govuk-body">Your password should not:</p>
        <ul class="govuk-list govuk-list--bullet">
            <li>contain your user information</li>
            <li>be the same as the last 5 passwords used</li>
        </ul>
        <form class="ui form login mb-two" method="post" id="change-password-form" action="/lo/reset">
            <input type="hidden" name="_csrf" value="{{csrf_token}}" />
            <input type="hidden" name="ticket" value="{{ticket}}" />
            <input type="hidden" name="email" value="{{email}}" />

            <div id="password-form-group" class="govuk-form-group">
                <label class="govuk-label" style="margin-top:8px;margin-bottom:0px" for="newPassword">New password
                </label>
                <span style="display: none" id="password-error" class="govuk-error-message">
                    <span class="govuk-visually-hidden">Error:</span>
                </span>
                <input type="password" autocomplete="off" class="govuk-input" name="newPassword" id="newPassword">
            </div>

            <div style="margin-top:30px;" id="confirmPassword-form-group" class="govuk-form-group">
                <label class="govuk-label" style="margin-top:8px;margin-bottom:0px" for="confirmNewPassword">Confirm new
                    password
                </label>
                <span style="display: none" id="confirmPassword-error" class="govuk-error-message">
                    <span class="govuk-visually-hidden">Error:</span>Confirm password is required
                </span>
                <input type="password" autocomplete="off" class="govuk-input" name="confirmNewPassword" id="confirmNewPassword">
            </div>
            <div style="margin-top:60px;" class="captcha-container form-group"></div>
            <button id="createPasswordButton" class="govuk-button" type="submit">Create
                password</button>
        </form>
    </div>

    <footer class="govuk-footer footer-global footer" role="contentinfo">
        <div class="govuk-width-container ">
            <div class="govuk-footer__meta">
                <div class="govuk-footer__meta-item">
                    <a class="govuk-footer__link logo" href="/"><img
                            src="https://res.cloudinary.com/ccssiteimage/image/upload/v1613028512/site/CCS_WHITE_SML_AW_space-01_p3dj6u.png"
                            alt="Go to the CCS homepage"></a>
                </div>
                <div class="govuk-footer__meta-item govuk-footer__meta-item--grow right-content">
                    <ul class="govuk-list">
                        <li>
                            <ul class="govuk-footer__inline-list">
                                <li class="govuk-footer__inline-list-item">
                                    <a href="https://twitter.com/gov_procurement" class="govuk-footer__link">
                                        <span class="icon">
                                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                                                <path fill="currentColor"
                                                    d="M24 4.557c-.883.392-1.832.656-2.828.775 1.017-.609 1.798-1.574 2.165-2.724-.951.564-2.005.974-3.127 1.195-.897-.957-2.178-1.555-3.594-1.555-3.179 0-5.515 2.966-4.797 6.045-4.091-.205-7.719-2.165-10.148-5.144-1.29 2.213-.669 5.108 1.523 6.574-.806-.026-1.566-.247-2.229-.616-.054 2.281 1.581 4.415 3.949 4.89-.693.188-1.452.232-2.224.084.626 1.956 2.444 3.379 4.6 3.419-2.07 1.623-4.678 2.348-7.29 2.04 2.179 1.397 4.768 2.212 7.548 2.212 9.142 0 14.307-7.721 13.995-14.646.962-.695 1.797-1.562 2.457-2.549z">
                                                </path>
                                            </svg>
                                        </span>
                                        <span class="visuallyhidden">Follow us on Twitter</span>
                                    </a>
                                </li>
                                <li class="govuk-footer__inline-list-item">
                                    <a href="https://www.linkedin.com/company/government-procurement-service/"
                                        class="govuk-footer__link">
                                        <span class="icon">
                                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                                                <path fill="currentColor"
                                                    d="M4.98 3.5c0 1.381-1.11 2.5-2.48 2.5s-2.48-1.119-2.48-2.5c0-1.38 1.11-2.5 2.48-2.5s2.48 1.12 2.48 2.5zm.02 4.5h-5v16h5v-16zm7.982 0h-4.968v16h4.969v-8.399c0-4.67 6.029-5.052 6.029 0v8.399h4.988v-10.131c0-7.88-8.922-7.593-11.018-3.714v-2.155z">
                                                </path>
                                            </svg>
                                        </span>
                                        <span class="visuallyhidden">Connect with us on LinkedIn</span>
                                    </a>
                                </li>
                            </ul>
                        </li>
                        <li>
                            <ul class="govuk-footer__inline-list">
                              <li class="govuk-footer__inline-list-item">
                                    <a class="govuk-footer__link"
                                    href="https://www.crowncommercial.gov.uk/contact">Contact CCS</a>
                                </li>
                                <li class="govuk-footer__inline-list-item">
                                    <a class="govuk-footer__link"
                                        href="https://dev.identify.crowncommercial.gov.uk/cookies">Cookies</a>
                                </li>
                                <li class="govuk-footer__inline-list-item">
                                    <a class="govuk-footer__link"
                                        href="https://www.gov.uk/government/publications/crown-commercial-service-privacy-notice">Privacy
                                        Policy</a>
                                </li>
                                <li class="govuk-footer__inline-list-item">
                                    <a class="govuk-footer__link"
                                        href="https://dev.identify.crowncommercial.gov.uk/terms-of-use">Terms of Use</a>
                                </li>
                                <li class="govuk-footer__inline-list-item">
                                    <a class="govuk-footer__link"
                                        href="https://dev.identify.crowncommercial.gov.uk/accessibility-statement">Accessibility Statement</a>
                                </li>
                                <li class="govuk-footer__inline-list-item">
                                    <a class="govuk-footer__link"
                                        href="https://www.nationalarchives.gov.uk/information-management/re-using-public-sector-information/uk-government-licensing-framework/crown-copyright/">Â©
                                        Crown copyright</a>
                                </li>
                            </ul>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </footer>

    <script src="//code.jquery.com/jquery-3.2.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js"
        integrity="sha384-b/U6ypiBEHpOf/4+1nzFpr53nxSS+GLCkfwBdFNTxtclqqenISfwAzpKaMNFNmj4" crossorigin="anonymous">
        </script>
    <script>
        var result_url = "https://dev.identify.crowncommercial.gov.uk"
        var resetView = $("#reset-view");
        var errorView = $("#error-view");
        var form = $("#change-password-form");
        debugger;

        $(document).ready(function () {
            $("#loginLink").attr("href", result_url);
        });

        function scrollToError(element, inputId) {
            debugger;
            let elementObj = document.getElementById(element);
            let inputObj = document.getElementById(inputId);
            elementObj.scrollIntoView();
            inputObj.focus();
        }

        form.submit(function (e) {
            e.preventDefault();

            var password = $("#newPassword");
            var confirmPassword = $("#confirmNewPassword");

            debugger;
            let passwordFG = document.getElementById('password-form-group');
            let confirmPasswordFG = document.getElementById('confirmPassword-form-group');
            passwordFG.classList.remove("invalid");
            confirmPasswordFG.classList.remove("invalid");

            let passwordEmpty = password.val().trim() == '';
            let confirmPasswordEmpty = confirmPassword.val().trim() == '';

            if (passwordEmpty || confirmPasswordEmpty) {
                if (passwordEmpty) {
                    passwordFG.classList.add("invalid");
                }

                if (confirmPasswordEmpty) {
                    confirmPasswordFG.classList.add("invalid");
                }

                displayErrorMessage(passwordEmpty, confirmPasswordEmpty);
                return;
            }

            if (password.val() != confirmPassword.val()) {
                displayErrorMessage(false, false, "Passwords do not match");
                return;
            }

            $.ajax({
                type: form.attr('method'),
                url: form.attr('action'),
                data: form.serialize(),
                success: handleSuccess,
                error: handleError
            });
        });

        var handleSuccess = function (res) {
            debugger;
            var field = "initial";
            var _status = window.location.href.indexOf('&' + field);

            if (_status != -1) {
                $('title').html("Success - Set Password - CCS");
                document.getElementById("longin-success-message").innerHTML = "Your password has been setup";
            }
            else {
                $('title').html("Success - Reset Password - CCS");
                document.getElementById("longin-success-message").innerHTML = "Your password has been changed";
            }
            $("#success-view").show();
            $("#reset-view").hide();
            // window.location.replace(result_url);
            var errorSummary = document.getElementById('error-summary');
            errorSummary.style.display = 'none';
        };

        var handleError = function (res) {
            if (res.responseJSON.name == "PasswordStrengthError") {
                displayErrorMessage(false, false, "Password does not align to the policy");
            }
            else if (res.responseJSON.name == "PasswordHistoryError") {
                displayErrorMessage(false, false, "Password should not be a recently used one");
            }
            else if (res.responseJSON.name == "PasswordNoUserInfoError") {
                displayErrorMessage(false, false, "Password should not have user information");
            }
            else {
                displayErrorMessage(false, false, res.responseJSON.message);
            }
        };

        var displayErrorMessage = function (isPasswordValidationError, isConfirmPasswordValidationError, backendValidationError) {
            // $("#inner-div-error-view").text(error);
            // $("#error-message").show();
            var errorSummary = document.getElementById('error-summary');
            errorSummary.style.display = 'block';

            var errorPassword = document.getElementById('li-error-summary-password');
            var errorPasswordSummary = document.getElementById('password-error');
            if (isPasswordValidationError) {
                errorPassword.style.display = 'block';
                errorPasswordSummary.style.display = 'block';
                errorPasswordSummary.innerHTML = 'Password is required';
            }
            else {
                errorPasswordSummary.style.display = 'none';
                errorPassword.style.display = 'none';
            }

            var errorConfirmPassword = document.getElementById('li-error-summary-confirmPassword');
            errorConfirmPassword.style.display = isConfirmPasswordValidationError ? 'block' : 'none';
            var confirmPasswordSummary = document.getElementById('confirmPassword-error');
            confirmPasswordSummary.style.display = isConfirmPasswordValidationError ? 'block' : 'none';

            var liErrorGeneral = document.getElementById('li-error-summary-general');
            liErrorGeneral.style.display = liErrorGeneral != undefined ? 'block' : 'none';
            var errorGeneral = document.getElementById('link-general-error');
            errorGeneral.style.display = backendValidationError != undefined ? 'block' : 'none';
            errorGeneral.innerHTML = backendValidationError;
            if (backendValidationError != undefined) {
                errorPasswordSummary.innerHTML = backendValidationError;
                errorPasswordSummary.style.display = 'block';
                let passwordFG = document.getElementById('password-form-group');
                passwordFG.classList.add("invalid");
            }

        };
    </script>

    <script src="https://cdn.auth0.com/js/change-password-1.5.min.js"></script>

    <script>
        new Auth0ChangePassword({
            container: "change-password-widget-container",                // required
            email: "{{email | escape}}",                              // DO NOT CHANGE THIS
            csrf_token: "{{csrf_token}}",                                  // DO NOT CHANGE THIS
            ticket: "{{ticket}}",                                      // DO NOT CHANGE THIS
            password_policy: "{{password_policy}}",                             // DO NOT CHANGE THIS
            password_complexity_options: {{ password_complexity_options }},        // DO NOT CHANGE THIS
            theme: {
            icon: "{{tenant.picture_url | default: 'https://res.cloudinary.com/ccssiteimage/image/upload/v1613028512/site/CCS_WHITE_SML_AW_space-01_p3dj6u.png'}}",
            primaryColor: "{{tenant.colors.primary | default: '#ea5323'}}"
        },
            dict: {
            // passwordPlaceholder: "your new password",
            // passwordConfirmationPlaceholder: "confirm your new password",
            // passwordConfirmationMatchError: "Please ensure the password and the confirmation are the same.",
            // passwordStrength: {
            //   containsAtLeast: "Contain at least %d of the following %d types of characters:",
            //   identicalChars: "No more than %d identical characters in a row (e.g., "%s" not allowed)",
            //   nonEmpty: "Non-empty password required",
            //   numbers: "Numbers (i.e. 0-9)",
            //   lengthAtLeast: "At least %d characters in length",
            //   lowerCase: "Lower case letters (a-z)",
            //   shouldContain: "Should contain:",
            //   specialCharacters: "Special characters (e.g. !@#$%^&*)",
            //   upperCase: "Upper case letters (A-Z)"
            // },
            // successMessage: "Your password has been reset successfully.",
            // configurationError: "An error ocurred. There appears to be a misconfiguration in the form.",
            // networkError: "The server cannot be reached, there is a problem with the network.",
            // timeoutError: "The server cannot be reached, please try again.",
            // serverError: "There was an error processing the password reset.",
            // headerText: "Enter a new password for<br />{email}",
            // title: "Change Password",
            // weakPasswordError: "Password is too weak."
            // passwordHistoryError: "Password has previously been used."
        }
    });
    </script>

</body>

</html>